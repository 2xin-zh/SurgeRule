<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Surge Customize</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <style>
    body{
        margin-bottom:50px;
    }
    </style>
</head>
<body>
<div class="jumbotron">
    <div class="container">
        <h1>定制并下载 Surge 规则</h1>
        <p>通过自定义节点信息并按需挑选规则，定制一份属于你自己的 Surge 规则吧。</p>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <form>
                <div class="section">
                    <h1 class="page-header"><span class="glyphicon glyphicon-tasks"></span> 节点信息</h1>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <textarea id="node_info" class="form-control" rows="5"></textarea>
                                <span class="help-block">填入你的节点信息。包括<code>[Proxy]</code>和<code>[Proxy Group]</code>段。</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h1 class="page-header"><span class="glyphicon glyphicon-cog"></span> 规则选取</h1>
                    <h2>基于域名的规则</h2>
                    <h3>增强规则</h3>
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-big_company" />大公司</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-blog" />博客</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-cdn" />公共CDN</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-design" />设计狮</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-developer" />程序猿</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-download" />下载站，BT下载</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-education" />教育机构</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-government" />政府机构</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-images" />图床和图片分享</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-music" />音乐和播客</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-net_disk" />网盘、云存储、文件分享</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-network" />网络服务</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-news" />新闻</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-shopping" />购物</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-sns" />社交网络</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-tools" />工具</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-url_shorter" />短链接</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-video" />视频分享</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-enhance-url_shorter" />其他</label>
                            </div>
                        </div>
                    </div>
                    <h3>去广告规则</h3>
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-ad_company" />广告公司</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-analysis" />统计公司</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-movie" />电影网站</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-shopping" />购物网站</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-sns" />社交网站</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-tool" />工具网站</label>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="domain-adblock-video" />视频网站</label>
                            </div>
                        </div>
                    </div>
                    <h2>基于 IP 的规则</h2>
                    <h3>增强规则</h3>
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="ip-enhance-telegram" />Telegram</label>
                            </div>
                        </div>
                    </div>
                    <h3>去广告规则</h3>
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            暂无
                        </div>
                    </div>
                    <h2>其他规则</h2>
                    <h3>Hosts</h3>
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            暂无
                        </div>
                    </div>
                    <h3>URL重写</h3>
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            <div class="checkbox">
                                <label><input type="checkbox" name="other-rewrite-qq" />QQ</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h1 class="page-header"><span class="glyphicon glyphicon-download-alt"></span> 下载</h1>
                    <p class="lead">庆祝一下！你的定制版 Surge 规则即将大功告成。只要点击下面的按钮就可以下载了。</p>
                    <button id="doit" class="btn btn-primary btn-block btn-lg">下载</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-json/2.6.0/jquery.json.min.js"></script>
<script src="js/base64.min.js"></script>
<script>
$(function(){
    // 规则生成和下载
    function make_rule(){
        cfg={
            "config":{
                "node":[],
                "category":[
                    "domain",
                    "ip",
                    "other"
                ]
            },
            "domain":{
                "enhance":[],
                "adblock":[]
            },
            "ip":{
                "enhance":[],
                "adblock":[]
            },
            "other": {
                "hosts": [],
                "rewrite": []
            }
        }
        // 读取节点信息
        cfg.config.node=$("#node_info").val().split("\n");
        // 读取配置信息
        cfg.config.category.forEach(function(category){
            Object.keys(cfg[category]).forEach(function(rule_set){
                obj = $(":checkbox:checked[name ^= "+ category+"-"+rule_set +"]");
                obj.each(function(ith){
                    name = obj[ith].name.replace(category+"-"+rule_set+"-","");
                    cfg[category][rule_set].push(name);
                })
            });
        })
        cfg_b64 = Base64.encode($.toJSON(cfg));
        open("Customize.php/?conf="+cfg_b64);
        return false;
    };
    // 初始化：全部选中
    $(":checkbox").attr("checked", 'checked');
    $("#doit").click(make_rule);
});
</script>
</body>
</html>
